import{_ as ae,a as le,c as A,t as K,G as F,y as H,ab as j,r as S,B as z,i as _,h as o,l as a,d as i,N as B,e as T,f as m,a7 as G,ac as O,F as Y,x as k,A as r,k as N,H as b,j as ne}from"./index-360cec32.js";import{u as se,T as D,S as h,a as oe,b as ie}from"./equipment-932d79d9.js";import{s as re,e as E}from"./loading-ca52e56c.js";const de={setup(){const L=le(),u=A(()=>!!L.user.id),{loadPromise:P}=K(L);P.value.then(()=>{u.value||F.alert("請先登入","提示",{confirmButtonText:"確定",callback:()=>{H.replace({name:j})}})});const e=se();e.init();const{equipments:y,equipmentsLoaded:U}=K(e),d=S([]),g=S([]),f=S([]),w=S(""),I=S(""),x=l=>{const n=l.split("-")[0],p=l.split("-")[1],s=l.split("-")[2];return{_id0:n,_id1:p,_id2:s}},M=A(()=>y.value.filter(n=>n.content.type===D.AI).map(n=>{const{_id0:p,_id1:s,_id2:c}=x(n.content._id);return{"id-prefix":`${p}-${s}`,id:c,status:n.content.status,statusStr:n.content.status===h.AVAILABLE?"可租借":"不可租借"}})),R=A(()=>y.value.filter(n=>n.content.type===D.VIA).map(n=>{const{_id0:p,_id1:s,_id2:c}=x(n.content._id);return{"id-prefix":`${p}-${s}`,id:c,status:n.content.status,statusStr:n.content.status===h.AVAILABLE?"可租借":"不可租借"}})),t=A(()=>y.value.filter(n=>n.content.type===D.ALK).map(n=>{const{_id0:p,_id1:s,_id2:c}=x(n.content._id);return{"id-prefix":`${p}-${s}`,id:c,status:n.content.status,statusStr:n.content.status===h.AVAILABLE?"可租借":"不可租借"}})),v=S({start:new Date,end:new Date}),J=A(()=>{const l=new Date(v.value.start);return l.setDate(l.getDate()+14),l}),Q=A(()=>new Date),W=A(()=>["09:00","09:15","09:30","09:45","10:00","10:15","10:30","10:45","11:00","11:15","11:30","11:45","12:00","14:00","14:15","14:30","14:45","15:00","15:15","15:30","15:45","16:00","16:15","16:30","16:45","17:00"]),X=(l,n)=>{console.log(n),n===D.AI?d.value=l:n===D.VIA?g.value=l:f.value=l},Z=(l,n)=>d.value.map(s=>`${s["id-prefix"]}${s.id}`).includes(`${l.row["id-prefix"]}${l.row.id}`)?"selected":l.row.status===h.AVAILABLE?"available":"unavailable",q=(l,n)=>g.value.map(s=>`${s["id-prefix"]}${s.id}`).includes(`${l.row["id-prefix"]}${l.row.id}`)?"selected":l.row.status===h.AVAILABLE?"available":"unavailable",$=(l,n)=>f.value.map(s=>`${s["id-prefix"]}${s.id}`).includes(`${l.row["id-prefix"]}${l.row.id}`)?"selected":l.row.status===h.AVAILABLE?"available":"unavailable",ee=(l,n)=>l.status===h.AVAILABLE,C=l=>z(Number(l)).format("YYYY-MM-DD");return{submitRent:async()=>{re();const l=d.value.map(c=>`${c["id-prefix"]}-${c.id}`),n=g.value.map(c=>`${c["id-prefix"]}-${c.id}`),p=f.value.map(c=>`${c["id-prefix"]}-${c.id}`),s={aiIds:l,viaIds:n,alkIds:p,allIds:[...l,...n,...p],start:C(v.value.start),end:C(v.value.end),selectedTime:w.value,returnTime:I.value};if(!s.selectedTime){B({message:"請選擇取件時間",type:"error"}),E();return}if(!s.returnTime){B({message:"請選擇歸還時間",type:"error"}),E();return}for(const c of s.allIds){y.value.map(V=>{if(V.content._id===c&&V.content.status===h.UNAVAILABLE){B({message:`設備 ${c} 已被租借`,type:"error"}),E();return}});const te=await e.generateAutoId();for(const V of s.allIds)await e.rentEquipment(V,{borrowerId:te,borrower:L.user.email,endDate:s.end,startDate:s.start,selectedTime:s.selectedTime,returnTime:s.returnTime});E()}F({title:"租借成功",message:"租借成功",type:"success",confirmButtonText:"確定",callback:()=>{H.replace({name:j})}}),console.log(s)},moment:z,toYYYYMMDD:C,tableRowClassName:Z,viaTableRowClassName:q,alkTableRowClassName:$,canSelectRow:ee,TYPE_NAME:oe,TYPE:D,STATUS:h,STATUS_NAME:ie,handleSelectionChange:X,aiTableData:M,viaTableData:R,alkTableData:t,equipments:y,equipmentsLoaded:U,maxDate:J,minDate:Q,range:v,availableTimes:W,selectedTime:w,returnTime:I,aiSelection:d,viaSelection:g,alkSelection:f}}},ce={class:"inner"},ue={class:"content-box"},_e=o("h2",null,"小栗方 Ai 學習機",-1),me=o("h2",null,"VIA Pixetto 視覺感測器",-1),fe=o("h2",null,"ALK950 邊緣運算推論器",-1),pe=o("option",{value:"",disabled:""},"選擇取件時間",-1),ve=["value"],be=o("option",{value:"",disabled:""},"選擇歸還時間",-1),he=["value"],ge=o("div",{class:"card-header"},[o("h3",null,"借用數量及編號")],-1),we={key:0,class:"title"},Te={class:"yellow"},xe={key:1,class:"title"},Ae={class:"yellow"},ye={key:2,class:"title"},Se={class:"yellow"},De={class:"title"},Ye={class:"wrapper"},ke={class:"title"},Le={class:"wrapper"},Ie={class:"yellow"},Ve={class:"title"},Ee={class:"wrapper"},Me={class:"yellow"},Re={class:"title"},Ce={class:"wrapper"};function Be(L,u,P,e,y,U){const d=T("el-table-column"),g=T("el-table"),f=T("el-col"),w=T("el-row"),I=T("VDatePicker"),x=T("el-form-item"),M=T("el-button"),R=T("el-card");return m(),_("div",ce,[o("div",ue,[a(w,{gutter:12},{default:i(()=>[a(f,{span:8,lg:8,sm:24,xs:24},{default:i(()=>[_e,a(g,{ref:"multipleTableRef",data:e.aiTableData,style:{width:"100%"},onSelectionChange:u[0]||(u[0]=t=>e.handleSelectionChange(t,e.TYPE.AI)),"row-class-name":e.tableRowClassName},{default:i(()=>[a(d,{type:"selection",width:"55",selectable:(t,v)=>e.canSelectRow(t,v,e.TYPE.AI)},null,8,["selectable"]),a(d,{property:"id-prefix",label:"編號",width:"114"}),a(d,{property:"id",label:"",width:"45"}),a(d,{property:"statusStr",label:"狀態"})]),_:1},8,["data","row-class-name"])]),_:1}),a(f,{span:8,lg:8,sm:24,xs:24},{default:i(()=>[me,a(g,{ref:"multipleTableRef",data:e.viaTableData,style:{width:"100%"},onSelectionChange:u[1]||(u[1]=t=>e.handleSelectionChange(t,e.TYPE.VIA)),"row-class-name":e.viaTableRowClassName},{default:i(()=>[a(d,{type:"selection",width:"55",selectable:(t,v)=>e.canSelectRow(t,v,e.TYPE.VIA)},null,8,["selectable"]),a(d,{property:"id-prefix",label:"編號",width:"114"}),a(d,{property:"id",label:"",width:"45"}),a(d,{property:"statusStr",label:"狀態"})]),_:1},8,["data","row-class-name"])]),_:1}),a(f,{span:8,lg:8,sm:24,xs:24},{default:i(()=>[fe,a(g,{ref:"multipleTableRef",data:e.alkTableData,style:{width:"100%"},onSelectionChange:u[2]||(u[2]=t=>e.handleSelectionChange(t,e.TYPE.ALK)),"row-class-name":e.alkTableRowClassName},{default:i(()=>[a(d,{type:"selection",width:"55",selectable:(t,v)=>e.canSelectRow(t,v,e.TYPE.ALK)},null,8,["selectable"]),a(d,{property:"id-prefix",label:"編號",width:"114"}),a(d,{property:"id",label:"",width:"45"}),a(d,{property:"statusStr",label:"狀態"})]),_:1},8,["data","row-class-name"])]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(f,null,{default:i(()=>[a(x,{label:"租借期間",prop:""},{default:i(()=>[a(I,{modelValue:e.range,"onUpdate:modelValue":u[3]||(u[3]=t=>e.range=t),modelModifiers:{range:!0},mode:"date"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(f,null,{default:i(()=>[a(x,{label:"取件時間",prop:""},{default:i(()=>[G(o("select",{"onUpdate:modelValue":u[4]||(u[4]=t=>e.selectedTime=t)},[pe,(m(!0),_(Y,null,k(e.availableTimes,t=>(m(),_("option",{key:t,value:t},r(t),9,ve))),128))],512),[[O,e.selectedTime]])]),_:1})]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(f,null,{default:i(()=>[a(x,{label:"歸還時間",prop:""},{default:i(()=>[G(o("select",{"onUpdate:modelValue":u[5]||(u[5]=t=>e.returnTime=t)},[be,(m(!0),_(Y,null,k(e.availableTimes,t=>(m(),_("option",{key:t,value:t},r(t),9,he))),128))],512),[[O,e.returnTime]])]),_:1})]),_:1})]),_:1}),a(w,{gutter:12},{default:i(()=>[a(f,{span:24},{default:i(()=>[a(R,{class:"box-card","body-style":{paddingTop:"36px",paddingBottom:"36px",paddingLeft:"20px",paddingRight:"20px",height:"auto"}},{header:i(()=>[ge]),default:i(()=>[e.aiSelection&&e.aiSelection.length>0?(m(),_("div",we," 小栗方 Ai 學習機 數量："+r(e.aiSelection.length),1)):N("",!0),(m(!0),_(Y,null,k(e.aiSelection,t=>(m(),_("div",{key:t,class:"text item"},[b(r(t["id-prefix"]+"-")+" ",1),o("span",Te,r(t.id),1)]))),128)),e.viaSelection&&e.viaSelection.length>0?(m(),_("div",xe," VIA Pixetto 視覺感測器 數量："+r(e.viaSelection.length),1)):N("",!0),(m(!0),_(Y,null,k(e.viaSelection,t=>(m(),_("div",{key:t,class:"text item"},[b(r(t["id-prefix"]+"-"),1),o("span",Ae,r(t.id),1)]))),128)),e.alkSelection&&e.alkSelection.length>0?(m(),_("div",ye," ALK950 邊緣運算推論器 數量："+r(e.alkSelection.length),1)):N("",!0),(m(!0),_(Y,null,k(e.alkSelection,t=>(m(),_("div",{key:t,class:"text item"},[b(r(t["id-prefix"]+"-"),1),o("span",Se,r(t.id),1)]))),128)),o("div",De,[b(" 租借期間 "),o("div",Ye,r(e.toYYYYMMDD(e.range.start))+" ~"+r(e.toYYYYMMDD(e.range.end)),1)]),o("div",ke,[b(" 取件時間： "),o("div",Le,[b(r(e.toYYYYMMDD(e.range.start))+" ",1),o("span",Ie,r(e.selectedTime),1)])]),o("div",Ve,[b(" 歸還時間： "),o("div",Ee,[b(r(e.toYYYYMMDD(e.range.end))+" ",1),o("span",Me,r(e.returnTime),1)])]),o("div",Re,[b(" 租借天數： "),o("div",Ce,r(e.moment(e.range.end).diff(e.moment(e.range.start),"days")?e.moment(e.range.end).diff(e.moment(e.range.start),"days"):"當")+"天 ",1)]),a(f,{span:24,style:{display:"flex"}},{default:i(()=>[a(M,{size:"large",type:"primary",onClick:ne(e.submitRent,["prevent"])},{default:i(()=>[b(" 租借送出 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})])])}const Fe=ae(de,[["render",Be]]);export{Fe as default};
