/* empty css              */import{g as K,b as ae}from"./runtime-dom.esm-bundler-d3981d03.js";import{k as z}from"./firebase-917d75a2.js";import{u as le,T as ne,a as S,S as h,b as oe}from"./equipment-9aff0d2b.js";import{u as se}from"./auth-69b1bf9c.js";import{r as F,H}from"./index-08706a63.js";import{w as O}from"./moment-820a4055.js";import{s as ie,e as V}from"./loading-f001d740.js";import{_ as re}from"./plugin-vue_export-helper-c27b6911.js";import{N as j}from"./index-97bb3002.js";import{a as B}from"./index-8788ed98.js";import{a as A,r as D,l as m,m as s,E as a,y as i,a3 as T,k as _,z as G,F as Y,Y as k,D as r,B as N,C as b}from"./runtime-core.esm-bundler-1860ea7f.js";import"./index-a861324b.js";const de={setup(){const L=se(),u=A(()=>!!L.user.id),{loadPromise:P}=z(L);P.value.then(()=>{u.value||j.alert("請先登入","提示",{confirmButtonText:"確定",callback:()=>{F.replace({name:H})}})});const e=le();e.init();const{equipments:y,equipmentsLoaded:U}=z(e),d=D([]),g=D([]),f=D([]),w=D(""),I=D(""),x=l=>{const n=l.split("-")[0],p=l.split("-")[1],o=l.split("-")[2];return{_id0:n,_id1:p,_id2:o}},M=A(()=>y.value.filter(n=>n.content.type===S.AI).map(n=>{const{_id0:p,_id1:o,_id2:c}=x(n.content._id);return{["id-prefix"]:`${p}-${o}`,id:c,status:n.content.status,statusStr:n.content.status===h.AVAILABLE?"可租借":"不可租借"}})),R=A(()=>y.value.filter(n=>n.content.type===S.VIA).map(n=>{const{_id0:p,_id1:o,_id2:c}=x(n.content._id);return{["id-prefix"]:`${p}-${o}`,id:c,status:n.content.status,statusStr:n.content.status===h.AVAILABLE?"可租借":"不可租借"}})),t=A(()=>y.value.filter(n=>n.content.type===S.ALK).map(n=>{const{_id0:p,_id1:o,_id2:c}=x(n.content._id);return{["id-prefix"]:`${p}-${o}`,id:c,status:n.content.status,statusStr:n.content.status===h.AVAILABLE?"可租借":"不可租借"}})),v=D({start:new Date,end:new Date}),J=A(()=>{const l=new Date(v.value.start);return l.setDate(l.getDate()+14),l}),Q=A(()=>new Date),W=A(()=>["09:00","09:15","09:30","09:45","10:00","10:15","10:30","10:45","11:00","11:15","11:30","11:45","12:00","14:00","14:15","14:30","14:45","15:00","15:15","15:30","15:45","16:00","16:15","16:30","16:45","17:00"]),X=(l,n)=>{console.log(n),n===S.AI?d.value=l:n===S.VIA?g.value=l:f.value=l},Z=(l,n)=>d.value.map(o=>`${o["id-prefix"]}${o.id}`).includes(`${l.row["id-prefix"]}${l.row.id}`)?"selected":l.row.status===h.AVAILABLE?"available":"unavailable",q=(l,n)=>g.value.map(o=>`${o["id-prefix"]}${o.id}`).includes(`${l.row["id-prefix"]}${l.row.id}`)?"selected":l.row.status===h.AVAILABLE?"available":"unavailable",$=(l,n)=>f.value.map(o=>`${o["id-prefix"]}${o.id}`).includes(`${l.row["id-prefix"]}${l.row.id}`)?"selected":l.row.status===h.AVAILABLE?"available":"unavailable",ee=(l,n)=>l.status===h.AVAILABLE,C=l=>O(Number(l)).format("YYYY-MM-DD");return{submitRent:async()=>{ie();const l=d.value.map(c=>`${c["id-prefix"]}-${c.id}`),n=g.value.map(c=>`${c["id-prefix"]}-${c.id}`),p=f.value.map(c=>`${c["id-prefix"]}-${c.id}`),o={aiIds:l,viaIds:n,alkIds:p,allIds:[...l,...n,...p],start:C(v.value.start),end:C(v.value.end),selectedTime:w.value,returnTime:I.value};if(!o.selectedTime){B({message:"請選擇取件時間",type:"error"}),V();return}if(!o.returnTime){B({message:"請選擇歸還時間",type:"error"}),V();return}for(const c of o.allIds){y.value.map(E=>{if(E.content._id===c&&E.content.status===h.UNAVAILABLE){B({message:`設備 ${c} 已被租借`,type:"error"}),V();return}});const te=await e.generateAutoId();for(const E of o.allIds)await e.rentEquipment(E,{borrowerId:te,borrower:L.user.email,endDate:o.end,startDate:o.start,selectedTime:o.selectedTime,returnTime:o.returnTime});V()}j({title:"租借成功",message:"租借成功",type:"success",confirmButtonText:"確定",callback:()=>{F.replace({name:H})}}),console.log(o)},moment:O,toYYYYMMDD:C,tableRowClassName:Z,viaTableRowClassName:q,alkTableRowClassName:$,canSelectRow:ee,TYPE_NAME:ne,TYPE:S,STATUS:h,STATUS_NAME:oe,handleSelectionChange:X,aiTableData:M,viaTableData:R,alkTableData:t,equipments:y,equipmentsLoaded:U,maxDate:J,minDate:Q,range:v,availableTimes:W,selectedTime:w,returnTime:I,aiSelection:d,viaSelection:g,alkSelection:f}}},ce={class:"inner"},ue={class:"content-box"},me=s("h2",null,"小栗方 Ai 學習機",-1),_e=s("h2",null,"VIA Pixetto 視覺感測器",-1),fe=s("h2",null,"ALK950 邊緣運算推論器",-1),pe=s("option",{value:"",disabled:""},"選擇取件時間",-1),ve=["value"],be=s("option",{value:"",disabled:""},"選擇歸還時間",-1),he=["value"],ge=s("div",{class:"card-header"},[s("h3",null,"借用數量及編號")],-1),we={key:0,class:"title"},Te={class:"yellow"},xe={key:1,class:"title"},Ae={class:"yellow"},ye={key:2,class:"title"},Se={class:"yellow"},De={class:"title"},Ye={class:"wrapper"},ke={class:"title"},Le={class:"wrapper"},Ie={class:"yellow"},Ee={class:"title"},Ve={class:"wrapper"},Me={class:"yellow"},Re={class:"title"},Ce={class:"wrapper"};function Be(L,u,P,e,y,U){const d=T("el-table-column"),g=T("el-table"),f=T("el-col"),w=T("el-row"),I=T("VDatePicker"),x=T("el-form-item"),M=T("el-button"),R=T("el-card");return _(),m("div",ce,[s("div",ue,[a(w,{gutter:12},{default:i(()=>[a(f,{span:8,lg:8,sm:24,xs:24},{default:i(()=>[me,a(g,{ref:"multipleTableRef",data:e.aiTableData,style:{width:"100%"},onSelectionChange:u[0]||(u[0]=t=>e.handleSelectionChange(t,e.TYPE.AI)),"row-class-name":e.tableRowClassName},{default:i(()=>[a(d,{type:"selection",width:"55",selectable:(t,v)=>e.canSelectRow(t,v,e.TYPE.AI)},null,8,["selectable"]),a(d,{property:"id-prefix",label:"編號",width:"114"}),a(d,{property:"id",label:"",width:"45"}),a(d,{property:"statusStr",label:"狀態"})]),_:1},8,["data","row-class-name"])]),_:1}),a(f,{span:8,lg:8,sm:24,xs:24},{default:i(()=>[_e,a(g,{ref:"multipleTableRef",data:e.viaTableData,style:{width:"100%"},onSelectionChange:u[1]||(u[1]=t=>e.handleSelectionChange(t,e.TYPE.VIA)),"row-class-name":e.viaTableRowClassName},{default:i(()=>[a(d,{type:"selection",width:"55",selectable:(t,v)=>e.canSelectRow(t,v,e.TYPE.VIA)},null,8,["selectable"]),a(d,{property:"id-prefix",label:"編號",width:"114"}),a(d,{property:"id",label:"",width:"45"}),a(d,{property:"statusStr",label:"狀態"})]),_:1},8,["data","row-class-name"])]),_:1}),a(f,{span:8,lg:8,sm:24,xs:24},{default:i(()=>[fe,a(g,{ref:"multipleTableRef",data:e.alkTableData,style:{width:"100%"},onSelectionChange:u[2]||(u[2]=t=>e.handleSelectionChange(t,e.TYPE.ALK)),"row-class-name":e.alkTableRowClassName},{default:i(()=>[a(d,{type:"selection",width:"55",selectable:(t,v)=>e.canSelectRow(t,v,e.TYPE.ALK)},null,8,["selectable"]),a(d,{property:"id-prefix",label:"編號",width:"114"}),a(d,{property:"id",label:"",width:"45"}),a(d,{property:"statusStr",label:"狀態"})]),_:1},8,["data","row-class-name"])]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(f,null,{default:i(()=>[a(x,{label:"租借期間",prop:""},{default:i(()=>[a(I,{modelValue:e.range,"onUpdate:modelValue":u[3]||(u[3]=t=>e.range=t),modelModifiers:{range:!0},mode:"date"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(f,null,{default:i(()=>[a(x,{label:"取件時間",prop:""},{default:i(()=>[G(s("select",{"onUpdate:modelValue":u[4]||(u[4]=t=>e.selectedTime=t)},[pe,(_(!0),m(Y,null,k(e.availableTimes,t=>(_(),m("option",{key:t,value:t},r(t),9,ve))),128))],512),[[K,e.selectedTime]])]),_:1})]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(f,null,{default:i(()=>[a(x,{label:"歸還時間",prop:""},{default:i(()=>[G(s("select",{"onUpdate:modelValue":u[5]||(u[5]=t=>e.returnTime=t)},[be,(_(!0),m(Y,null,k(e.availableTimes,t=>(_(),m("option",{key:t,value:t},r(t),9,he))),128))],512),[[K,e.returnTime]])]),_:1})]),_:1})]),_:1}),a(w,{gutter:12},{default:i(()=>[a(f,{span:24},{default:i(()=>[a(R,{class:"box-card","body-style":{paddingTop:"36px",paddingBottom:"36px",paddingLeft:"20px",paddingRight:"20px",height:"auto"}},{header:i(()=>[ge]),default:i(()=>[e.aiSelection&&e.aiSelection.length>0?(_(),m("div",we," 小栗方 Ai 學習機 數量："+r(e.aiSelection.length),1)):N("",!0),(_(!0),m(Y,null,k(e.aiSelection,t=>(_(),m("div",{key:t,class:"text item"},[b(r(t["id-prefix"]+"-")+" ",1),s("span",Te,r(t.id),1)]))),128)),e.viaSelection&&e.viaSelection.length>0?(_(),m("div",xe," VIA Pixetto 視覺感測器 數量："+r(e.viaSelection.length),1)):N("",!0),(_(!0),m(Y,null,k(e.viaSelection,t=>(_(),m("div",{key:t,class:"text item"},[b(r(t["id-prefix"]+"-"),1),s("span",Ae,r(t.id),1)]))),128)),e.alkSelection&&e.alkSelection.length>0?(_(),m("div",ye," ALK950 邊緣運算推論器 數量："+r(e.alkSelection.length),1)):N("",!0),(_(!0),m(Y,null,k(e.alkSelection,t=>(_(),m("div",{key:t,class:"text item"},[b(r(t["id-prefix"]+"-"),1),s("span",Se,r(t.id),1)]))),128)),s("div",De,[b(" 租借期間 "),s("div",Ye,r(e.toYYYYMMDD(e.range.start))+" ~"+r(e.toYYYYMMDD(e.range.end)),1)]),s("div",ke,[b(" 取件時間： "),s("div",Le,[b(r(e.toYYYYMMDD(e.range.start))+" ",1),s("span",Ie,r(e.selectedTime),1)])]),s("div",Ee,[b(" 歸還時間： "),s("div",Ve,[b(r(e.toYYYYMMDD(e.range.end))+" ",1),s("span",Me,r(e.returnTime),1)])]),s("div",Re,[b(" 租借天數： "),s("div",Ce,r(e.moment(e.range.end).diff(e.moment(e.range.start),"days")?e.moment(e.range.end).diff(e.moment(e.range.start),"days"):"當")+"天 ",1)]),a(f,{span:24,style:{display:"flex"}},{default:i(()=>[a(M,{size:"large",type:"primary",onClick:ae(e.submitRent,["prevent"])},{default:i(()=>[b(" 租借送出 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})])])}const Ze=re(de,[["render",Be]]);export{Ze as default};
