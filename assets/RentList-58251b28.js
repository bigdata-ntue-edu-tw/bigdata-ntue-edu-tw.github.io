import{a as N,c as y,t as B,G as k,y as V,ab as j,i as d,h as e,a7 as I,a8 as O,l as n,d as a,e as p,f as i,F as f,x as b,b as R,A as t,k as A,j as F,H as w,N as H}from"./index-c5edcf22.js";import{u as P}from"./equipment-9e6cceaf.js";import{s as G,e as $}from"./loading-ee1db5ca.js";const z={class:"inner"},J={class:"content-box"},K={class:"card-header borrow__header"},Q={class:"borrow__start"},U={class:"borrow__end"},W={class:"borrow__list"},X={class:"borrow__item__name"},Y={class:"yellow"},ne={__name:"RentList",setup(Z){const v=N(),x=y(()=>!!v.user.id),{loadPromise:D}=B(v);D.value.then(()=>{x.value||k.alert("請先登入","提示",{confirmButtonText:"確定",callback:()=>{V.replace({name:j})}})});const m=P();m.init();const{equipments:h,equipmentsLoaded:ee}=B(m),E=_=>{const o={};for(const r of _)r.borrowerId&&(o[r.borrowerId]||(o[r.borrowerId]=[]),o[r.borrowerId].push(r));return o},g=y(()=>(console.log(h.value),E(h.value.map(o=>o.content)))),L={1:"個人(學生)",2:"個人(教師)",3:"團體(師或生)"},q=async _=>{k.confirm("確定歸還內容都正確","確認歸還",{confirmButtonText:"確定歸還",cancelButtonText:"取消",callback:async o=>{if(o==="confirm"){G();const r=_.map(c=>c._id);await Promise.all(r.map(c=>m.giveBackEquipment(c))),$(),H({type:"success",message:"歸還成功"})}}})};return(_,o)=>{const r=p("el-empty"),l=p("el-col"),c=p("el-row"),S=p("el-button"),T=p("el-card");return i(),d("div",z,[e("div",J,[I(e("div",null,[n(r,{description:"目前沒有租借紀錄"})],512),[[O,!Object.keys(g.value).length]]),n(c,{gutter:12},{default:a(()=>[(i(!0),d(f,null,b(Object.entries(g.value),(s,C)=>(i(),R(l,{span:24,key:C},{default:a(()=>[n(T,{class:"box-card borrow"},{header:a(()=>[e("div",K,[n(c,{gutter:20},{default:a(()=>[n(l,{span:24},{default:a(()=>[e("span",null,"借物 ID："+t(s[0]),1)]),_:2},1024),n(l,{span:24},{default:a(()=>[e("span",null,"租借人登入帳號 Email： "+t(s[1][0].borrower),1)]),_:2},1024),s[1][0].borrowerData?(i(),d(f,{key:0},[n(l,{span:24},{default:a(()=>[e("span",null,"租借人身份： "+t(L[s[1][0].borrowerData.identity]),1)]),_:2},1024),n(l,{span:24},{default:a(()=>[e("span",null,"租借人姓名： "+t(s[1][0].borrowerData.name),1)]),_:2},1024),n(l,{span:24},{default:a(()=>[e("span",null,"租借人手機： "+t(s[1][0].borrowerData.phone),1)]),_:2},1024),n(l,{span:24},{default:a(()=>[e("span",null,"租借人系級(課名)： "+t(s[1][0].borrowerData.department),1)]),_:2},1024),n(l,{span:24},{default:a(()=>[e("span",null,"租借人填寫 Email： "+t(s[1][0].borrowerData.email),1)]),_:2},1024)],64)):A("",!0)]),_:2},1024),n(S,{class:"button",onClick:F(u=>q(s[1]),["prevent"])},{default:a(()=>[w("完成歸還")]),_:2},1032,["onClick"])])]),default:a(()=>[e("div",Q," 租借期間："+t(s[1][0].startDate)+" - "+t(s[1][0].endDate),1),e("div",U," 歸還時間："+t(s[1][0].returnTime),1),e("div",W," 租借項目：共 "+t(s[1].length)+" 項 ",1),(i(!0),d(f,null,b(s[1],(u,M)=>(i(),d("div",{class:"borrow__item",key:M},[e("div",X,[w(t(u.name)+" "+t(u._id.split("-")[0])+"-"+t(u._id.split("-")[1])+"-",1),e("span",Y,t(u._id.split("-")[2]),1)])]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})])])}}};export{ne as default};
